<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>QuestionÃ¡rio â€” EnglishPlay</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Pequenos ajustes especÃ­ficos da pÃ¡gina (mantÃ©m o visual do site) */
    .page-card {
      max-width: 720px;
      margin: 32px auto;
      padding: 22px;
      border-radius: 14px;
      background: #0f0f10;
      border: 2px solid var(--yellow);
    }
    .page-grid {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 22px;
      align-items: start;
    }
    .profile-panel {
      background: var(--card);
      padding:16px;
      border-radius:12px;
      text-align:center;
      border:1px solid #222;
    }
    .profile-avatar-lg { width:130px;height:130px;border-radius:50%;border:4px solid var(--yellow);margin:auto;display:block; }
    .question-box { padding:14px; border-radius:12px; background:#0e0e0e; border:1px solid #222; }
    .q-row { margin-top:10px; display:flex; flex-direction:column; gap:8px; }
    .q-actions { margin-top:14px; display:flex; gap:12px; }
    .btn.full { width:100%; padding:12px; border-radius:12px; font-weight:800; background:var(--yellow); color:#000; border:none; cursor:pointer; }
    .note { font-size:13px; color:var(--text-muted); margin-top:8px; }
    @media(max-width:900px){
      .page-grid { grid-template-columns: 1fr; }
      .profile-panel { order: -1; }
    }
  </style>
</head>
<body class="page fade-in">

  <!-- Navbar reuse (logo + search) -->
  <header class="navbar">
    <div class="nav-left">
      <img src="logo.png" class="logo-small" />
      <div class="brand-area">
        <div class="brand">EnglishPlay</div>
        <div class="subtitle">Seu portal de estudos</div>
      </div>
    </div>

    <div class="nav-middle">
      <input id="searchUsersTop" placeholder="Pesquisar usuÃ¡rios..." />
    </div>

    <div id="userAreaTop" class="nav-right"></div>
  </header>

  <main class="page-card">

    <div class="page-grid">
      <!-- esquerda: questionÃ¡rio -->
      <div>
        <h2 style="margin:0 0 8px 0;">QuestionÃ¡rio inicial</h2>
        <p class="note">Ajuda a personalizar seu plano â€” leve 1 minuto.</p>

        <div class="question-box" id="questionBox">

          <div class="q-row">
            <label>Como ficou sabendo do EnglishPlay?</label>
            <select id="q_source">
              <option>Instagram</option>
              <option>TikTok</option>
              <option>Amigos</option>
              <option>Outro</option>
            </select>
          </div>

          <div class="q-row">
            <label>Meta diÃ¡ria (dias consecutivos)</label>
            <select id="q_days">
              <option value="3">3 dias</option>
              <option value="7">7 dias</option>
              <option value="14">14 dias</option>
              <option value="30">30 dias</option>
            </select>
          </div>

          <div class="q-row">
            <label>Para que vocÃª quer aprender inglÃªs?</label>
            <select id="q_reason">
              <option>Estudos</option>
              <option>Trabalho</option>
              <option>Viagem</option>
              <option>Lazer</option>
            </select>
          </div>

          <div class="q-row">
            <label>NÃ­vel atual</label>
            <div style="display:flex;gap:18px;align-items:center;">
              <label><input type="radio" name="q_level" value="nada" checked> Nada</label>
              <label><input type="radio" name="q_level" value="pouco"> Pouco</label>
              <label><input type="radio" name="q_level" value="basico"> BÃ¡sico</label>
              <label><input type="radio" name="q_level" value="fluente"> Fluente</label>
            </div>
          </div>

          <div class="q-actions">
            <button id="qSaveBtn" class="btn full">Finalizar e voltar</button>
            <button id="qCancelBtn" class="btn ghost">Cancelar</button>
          </div>

          <div id="qMsg" class="note" style="display:none"></div>
        </div>
      </div>

      <!-- direita: mini perfil -->
      <aside class="profile-panel">
        <img id="profileAvatar" src="logo.png" class="profile-avatar-lg" alt="Avatar">
        <h3 id="profileName" style="margin-top:12px">Visitante</h3>
        <div id="profileStats" style="margin-top:8px;color:var(--text-muted)">â€”</div>
        <div style="margin-top:12px">
          <button id="backHome" class="btn ghost">Voltar ao inÃ­cio</button>
        </div>
      </aside>
    </div>

  </main>

<script>
/* questionnaire.html script â€” salva no localStorage e redireciona */

function dbLoad(){
  try{ return JSON.parse(localStorage.getItem("englishplay_db")) || { users: [] }; } catch { return { users: [] }; }
}
function dbSave(db){ localStorage.setItem("englishplay_db", JSON.stringify(db)); }
function getSession(){ try{ return JSON.parse(localStorage.getItem("englishplay_session")); }catch{ return null; } }
function setSession(s){ localStorage.setItem("englishplay_session", JSON.stringify(s)); }

const qSaveBtn = document.getElementById('qSaveBtn');
const qCancelBtn = document.getElementById('qCancelBtn');
const profileName = document.getElementById('profileName');
const profileStats = document.getElementById('profileStats');
const profileAvatar = document.getElementById('profileAvatar');

function showProfileInfo(){
  const s = getSession();
  if(!s){
    profileName.textContent = "Visitante";
    profileStats.textContent = "FaÃ§a login para salvar progresso.";
    return;
  }
  profileName.textContent = s.username;
  profileStats.innerHTML = `ðŸ”¥ ${s.streak || 0} dias<br>â­ ${s.xp || 0} XP`;
  if(s.avatar) profileAvatar.src = s.avatar;
}

/* Salva o questionÃ¡rio no usuÃ¡rio logado e volta para index */
qSaveBtn.addEventListener('click', ()=>{
  const s = getSession();
  if(!s){
    alert("VocÃª precisa fazer login antes de finalizar o questionÃ¡rio.");
    return;
  }

  const source = document.getElementById('q_source').value;
  const days = document.getElementById('q_days').value;
  const reason = document.getElementById('q_reason').value;
  const level = document.querySelector("input[name='q_level']:checked").value;

  s.questionnaire = { source, days, reason, level };

  // atualizar no db
  const db = dbLoad();
  const idx = db.users.findIndex(u=>u.id === s.id);
  if(idx >= 0) db.users[idx] = s;
  dbSave(db);
  setSession(s);

  // mensagem rÃ¡pida e redirecionamento
  const msg = document.getElementById('qMsg');
  msg.style.display = 'block';
  msg.textContent = 'QuestionÃ¡rio salvo! Redirecionando...';
  setTimeout(()=>{ window.location.href = 'index.html'; }, 900);
});

/* cancelar volta pra home sem salvar */
qCancelBtn.addEventListener('click', ()=> window.location.href = 'index.html');

/* botÃ£o voltar do painel lateral */
document.getElementById('backHome').addEventListener('click', ()=> window.location.href = 'index.html');

showProfileInfo();
</script>

</body>
</html>
