<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Amigos ‚Äî EnglishPlay</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header class="navbar">
  <div class="nav-logo" onclick="location.href='index.html'">
    <img src="logo.png"><span class="nav-title">EnglishPlay</span>
  </div>
  <input class="search-box" placeholder="Pesquisar..." disabled>
  <div class="nav-user" onclick="logout()">Sair</div>
</header>

<div class="main" style="margin-top:130px; justify-content:center;">
  <div class="section-box" style="width:760px;">
    <h2 class="section-title">ü§ù Amigos</h2>

    <div style="display:flex;gap:12px;margin-bottom:12px;">
      <input id="friendSearchInput" placeholder="Pesquisar usu√°rio para adicionar..." style="flex:1;padding:10px;border-radius:10px;background:#121212;border:2px solid #222;color:white;">
      <button class="btn-main" onclick="sendFriend()">Enviar pedido</button>
    </div>

    <div style="display:flex; gap:20px;">
      <div style="flex:1">
        <h3>Seus amigos</h3>
        <div id="friendsList">Carregando...</div>
      </div>
      <div style="flex:1">
        <h3>Pedidos recebidos</h3>
        <div id="requestsList">Carregando...</div>
      </div>
    </div>

  </div>
</div>

<script>
const DB = JSON.parse(localStorage.getItem("users")) || {};
let SESSION = JSON.parse(localStorage.getItem("session")) || null;
if(!SESSION){ location.href='auth.html'; }

function renderFriends() {
  const fl = document.getElementById("friendsList");
  const friends = SESSION.friends || [];
  if(!friends.length){ fl.innerHTML = "<p>Nenhum amigo ainda.</p>"; return; }
  fl.innerHTML = friends.map(f=>`<div style="padding:8px;border-bottom:1px solid #222">${f}</div>`).join("");
}

function renderRequests(){
  const rl = document.getElementById("requestsList");
  const reqs = SESSION.requests || [];
  if(!reqs.length){ rl.innerHTML="<p>Sem pedidos.</p>"; return; }
  rl.innerHTML = reqs.map(r=>`
    <div style="padding:8px;border-bottom:1px solid #222">
      ${r} <button class="btn-main" style="margin-left:8px;" onclick="accept('${r}')">Aceitar</button>
    </div>
  `).join("");
}

function sendFriend(){
  const name = document.getElementById("friendSearchInput").value.trim();
  if(!name) return alert("Digite um nome.");
  if(!DB[name]) return alert("Usu√°rio n√£o encontrado.");
  if((SESSION.requests||[]).includes(name)) return alert("J√° h√° pedido pendente.");
  if((SESSION.friends||[]).includes(name)) return alert("J√° √© seu amigo.");

  DB[name].requests = DB[name].requests || [];
  DB[name].requests.push(SESSION.name);
  localStorage.setItem("users", JSON.stringify(DB));
  alert("Pedido enviado!");
}

function accept(name){
  // adicionar amizade bilateral
  SESSION.requests = SESSION.requests.filter(r=>r!==name);
  SESSION.friends = SESSION.friends || [];
  SESSION.friends.push(name);

  DB[SESSION.name] = SESSION;
  DB[name].friends = DB[name].friends || [];
  DB[name].friends.push(SESSION.name);

  localStorage.setItem("users", JSON.stringify(DB));
  localStorage.setItem("session", JSON.stringify(SESSION));
  renderFriends(); renderRequests();
  alert("Amizade aceita!");
}

document.addEventListener("DOMContentLoaded", ()=>{ renderFriends(); renderRequests(); });
</script>

</body>
</html>
