<!doctype html>
<html lang="pt-BR">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Perfil â€” EnglishPlay</title><link rel="stylesheet" href="style.css"></head>
<body class="page">
<header class="navbar"><div class="nav-left"><img src="logo.png" class="logo-small"/><div class="brand-area"><div class="brand">EnglishPlay</div></div></div></header>
<main style="max-width:900px;margin:30px auto;padding:18px">
  <div style="display:grid;grid-template-columns:220px 1fr;gap:20px">
    <div style="background:var(--card);padding:18px;border-radius:12px;border:2px solid #222">
      <img id="pfAvatar" src="logo.png" style="width:140px;height:140px;border-radius:50%;display:block;margin:auto;border:4px solid var(--yellow)">
      <h3 id="pfName" style="text-align:center;margin-top:10px">UsuÃ¡rio</h3>
      <p id="pfStats" style="text-align:center;color:var(--muted)">â€”</p>
      <div style="text-align:center;margin-top:10px">
        <input id="avatarUrl" placeholder="URL da imagem do avatar"/><button id="saveAvatar" class="btn">Salvar avatar</button>
      </div>
    </div>
    <div style="background:var(--card);padding:18px;border-radius:12px;border:2px solid #222">
      <h2>Editar Perfil</h2>
      <label>Nome (atÃ© 3 vezes)</label>
      <input id="editName"/>
      <div style="margin-top:12px">
        <button id="saveName" class="btn">Salvar</button>
        <button id="backHome2" class="btn ghost">Voltar</button>
      </div>
      <hr style="margin:14px 0;border-color:#222"/>
      <h3>Amigos</h3>
      <div id="friendsList"></div>
      <h4>Pedidos</h4>
      <div id="requestsList"></div>
    </div>
  </div>
</main>
<script>
function dbLoad(){ try{ return JSON.parse(localStorage.getItem('englishplay_db')) || { users:[] }; } catch { return { users:[] }; } }
function dbSave(db){ localStorage.setItem('englishplay_db', JSON.stringify(db)); }
function sessionLoad(){ try{ return JSON.parse(localStorage.getItem('englishplay_session')); } catch { return null } }
function sessionSave(s){ localStorage.setItem('englishplay_session', JSON.stringify(s)); }
let DB = dbLoad(); let s = sessionLoad();
if(!s) return location.href='index.html';
document.getElementById('pfName').textContent = s.username;
document.getElementById('pfStats').innerHTML = `ðŸ”¥ ${s.streak||0} dias<br>â­ ${s.xp||0} XP`;
if(s.avatar) document.getElementById('pfAvatar').src = s.avatar;
document.getElementById('saveAvatar').onclick = ()=>{
  const url = document.getElementById('avatarUrl').value.trim(); if(!url) return alert('URL vazia');
  s.avatar = url; sessionSave(s); const i = DB.users.findIndex(u=>u.id===s.id); if(i>=0) DB.users[i]=s; dbSave(DB); alert('Avatar salvo'); location.reload();
}
let nameChanges = s.nameChanges || 0;
document.getElementById('saveName').onclick = ()=>{
  if(nameChanges>=3) return alert('Limite de alteraÃ§Ã£o de nome atingido');
  const newName = document.getElementById('editName').value.trim();
  if(!newName) return;
  s.username = newName; nameChanges++; s.nameChanges = nameChanges; sessionSave(s); const i = DB.users.findIndex(u=>u.id===s.id); if(i>=0) DB.users[i]=s; dbSave(DB); alert('Nome salvo'); location.reload();
}
document.getElementById('backHome2').onclick = ()=> location.href='index.html';
function renderFriends(){
  const fl = document.getElementById('friendsList'); fl.innerHTML = '';
  (s.friends||[]).forEach(f=> fl.innerHTML += `<div style="padding:8px;border-bottom:1px solid #222">${f}</div>`);
  const rl = document.getElementById('requestsList'); rl.innerHTML = '';
  (s.requests||[]).forEach(r=> rl.innerHTML += `<div style="padding:8px;border-bottom:1px solid #222">${r} <button class="btn ghost" onclick="accept('${r}')">Aceitar</button></div>`);
}
window.accept = (r)=>{ s.requests = s.requests.filter(x=>x!==r); s.friends = [...(s.friends||[]), r]; const i = DB.users.findIndex(u=>u.id===s.id); DB.users[i]=s; const other = DB.users.find(u=>u.username===r); if(other){ other.friends = [...(other.friends||[]), s.username]; } dbSave(DB); sessionSave(s); renderFriends(); alert('Amizade aceita') }
renderFriends();
</script>
</body>
</html>
